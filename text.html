<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Text</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-red: #ff4d6a;
            --bg-dark: #0f0f13;
            --card-bg: #ffffff;
            --text-gray: #8e8e93;
            --input-bg: #1c1c1e;
        }

        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            height: 100%;
            overflow: hidden;
        }

        /* Container transitions */
        .view {
            display: none;
            height: 100vh;
            flex-direction: column;
            animation: fadeIn 0.3s ease-in-out;
        }

        .view.active { display: flex; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Header Styles --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: transparent;
        }

        .header-title { font-weight: 600; font-size: 18px; color: #333; }
        .back-btn { font-size: 22px; cursor: pointer; color: #333; }
        
        .next-btn {
            background-color: #f0f0f0;
            color: #fff;
            padding: 6px 18px;
            border-radius: 20px;
            font-weight: 600;
            border: none;
            transition: 0.3s;
        }
        .next-btn.active { background-color: var(--primary-red); cursor: pointer; }

        /* --- View 0: Share Thoughts --- */
        #view0 { background: linear-gradient(to bottom, #e0f7f4, #ffffff); }
        .thought-card {
            background: white;
            margin: 20px;
            padding: 40px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            flex: 1;
            max-height: 400px;
            position: relative;
        }
        .quote-icon { font-size: 60px; color: #eee; position: absolute; top: 20px; left: 20px; }
        .thought-input {
            width: 100%;
            border: none;
            outline: none;
            font-size: 24px;
            font-weight: 600;
            color: #333;
            resize: none;
            margin-top: 40px;
        }
        .article-link-card {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        /* --- View 00: Write Articles --- */
        #view00 { background: white; color: #333; }
        .article-body {
    padding: 20px;
    flex: 1;
    overflow-y: auto;
    padding-bottom: 80px; /* مسافة إضافية للزر */
    scrollbar-width: none;
}
        .article-body::-webkit-scrollbar { display: none; }
        .title-input { font-size: 28px; font-weight: 700; border: none; outline: none; width: 100%; margin-bottom: 20px; color: #333; }
        .content-textarea { font-size: 18px; border: none; outline: none; width: 100%; height: 70%; resize: none; color: #666; }
        .format-bar {
    position: fixed; /* تثبيت الشريط في الأسفل */
    bottom: 0;
    left: 0;
    right: 0;
    padding: 15px;
    text-align: center;
    background: white; /* لضمان عدم تداخل النص خلفه */
    border-top: 1px solid #eee;
    z-index: 100; /* ليكون فوق محتوى المقال */
}
        .format-btn {
            background: #f0f0f0;
            color: white;
            width: 90%;
            padding: 12px;
            border-radius: 25px;
            border: none;
            font-weight: 600;
        }
        .format-btn.active { background: var(--primary-red); }

        /* --- View 0000: Post Note --- */
        #view0000 { background: var(--bg-dark); color: white; }
        #view0000 .back-btn, #view0000 .header-title { color: white; }
        .post-container { padding: 20px; flex: 1; overflow-y: auto; scrollbar-width: none; }
        .post-container::-webkit-scrollbar { display: none; }
        
        .preview-title { font-size: 22px; font-weight: 600; margin-bottom: 10px; color: #ccc; }
        .preview-text { font-size: 18px; line-height: 1.6; color: #eee; margin-bottom: 30px; }

        .tag-row { display: flex; gap: 10px; margin-bottom: 30px; }
        .tag-item { background: #2c2c2e; padding: 8px 15px; border-radius: 15px; font-size: 14px; }

        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-top: 1px solid #2c2c2e;
            color: #eee;
        }
        .footer-btns {
    position: fixed; /* تثبيت العنصر */
    bottom: 0;      /* في أقصى الأسفل */
    left: 0;
    right: 0;
    gap: 12px;
    padding: 15px 20px;
    background-color: #0f0f13;
    border-top: 1px solid #807f7f;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000; /* لضمان ظهوره فوق العناصر الأخرى */
}

/* أضف هذا الجزء لضمان عدم اختفاء محتوى الصفحة خلف الفوتر المثبت */
.view {
    padding-bottom: 80px; 
}
        .save-draft { background: #2c2c2e; flex: 1; padding: 15px; border-radius: 30px; color: white; border: none; }
        .post-note { background: var(--primary-red); flex: 2; padding: 15px; border-radius: 30px; color: white; border: none; font-weight: 700;}

        /* Alert Box */
        .custom-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            z-index: 3000;
            display: none;
        }

        /* تحسين الكارد الأساسي */
.thought-card {
    background: white;
    margin: 20px;
    padding: 25px;
    border-radius: 24px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.04);
    display: flex;
    flex-direction: column;
    min-height: 250px;
    border: 1px solid #f0f0f0;
}

/* تنسيق رأس الكارد (الأيقونة والنص المساعد) */
.card-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.quote-icon {
    font-size: 20px; /* تصغير الحجم ليكون لطيفاً */
    color: var(--primary-red);
    opacity: 0.8;
}

.hint-text {
    color: #8e8e93;
    font-size: 13px;
    font-weight: 400;
}

/* تحسين منطقة الكتابة */
.thought-input {
    width: 100%;
    border: none;
    outline: none;
    font-size: 20px;
    line-height: 1.5;
    font-weight: 500;
    color: #1c1c1e;
    resize: none;
    background: transparent;
    flex: 1;
}

/* عداد الحروف في الزاوية */
.char-counter {
    text-align: right;
    font-size: 12px;
    color: #ccc;
    margin-top: 10px;
}
    </style>
</head>
<body>

    <div id="alertBox" class="custom-alert"></div>

    <div id="view0" class="view active">
        <header>
            <i class="fas fa-times back-btn" onclick="window.location.href='home.html'"></i>
            <button class="next-btn" id="nextBtn0" onclick="goToPost('thought')">Next</button>
        </header>
        <div class="thought-card">
    <div class="card-header">
        <i class="fas fa-quote-left quote-icon"></i>
        <div style="margin-bottom: 80px;"></div>
        <span class="hint-text">Say something or ask a question...</span>
    </div>
    <div style="margin-bottom: -60px;"></div>
    <textarea class="thought-input" id="thoughtInput" placeholder="What's on your mind?" maxlength="50"></textarea>
    <div class="char-counter"><span id="charCount">0</span>/50</div>
</div>
        <div class="article-link-card" onclick="switchView('view00')">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="background:#f0f0f0; padding:10px; border-radius:10px;"><i class="fas fa-edit"></i></div>
                <div>
                    <div style="font-weight:600;">Write articles</div>
                    <div style="font-size:12px; color:gray;">Full screen for 1k+ words</div>
                </div>
            </div>
            <i class="fas fa-chevron-right" style="color:#ccc;"></i>
        </div>
    </div>

    <div id="view00" class="view">
        <header>
            <i class="fas fa-chevron-left back-btn" onclick="switchView('view0')"></i>
            <div class="header-title">Write articles</div>
            <div style="width:30px;"></div>
        </header>
        <div class="article-body">
            <input type="text" class="title-input" id="articleTitle" placeholder="enter title">
            <textarea class="content-textarea" id="articleContent" placeholder="paste here or enter text, content will be saved automatically"></textarea>

            <div style="height: 50px;"></div>
        </div>
        <div class="format-bar">
            <button class="format-btn" id="formatBtn" onclick="goToPost('article')">Format Text</button>
        </div>
    </div>

    <div id="view0000" class="view">
        <header>
            <i class="fas fa-chevron-left back-btn" id="finalBackBtn"></i>
            <div class="header-title">Post</div>
            <div style="width:30px;"></div>
        </header>
        <div class="post-container">
            <div class="preview-title" id="previewTitle"></div>
            <div class="preview-text" id="previewText"></div>

            <div class="tag-row">
                <div class="tag-item"># Topic</div>
                <div class="tag-item">@ User</div>
                <div class="tag-item"><i class="fas fa-poll"></i> Multiple Choices</div>
            </div>

            <div class="menu-item" onclick="togglePrivacy()" style="cursor:pointer">
                <span><i class="fas fa-lock-open" id="privacyIcon"></i> <span id="privacyText">Public</span></span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="menu-item">
                <span><i class="fas fa-th-large"></i> Add widgets</span>
                <span style="color:gray;">Select File <i class="fas fa-chevron-right"></i></span>
            </div>
            <div class="menu-item">
                <span><i class="fas fa-cog"></i> Advanced options</span>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
        <div class="footer-btns">
            <button class="save-draft">Save draft</button>
            <button class="post-note" id="postFinalBtn">Post note</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAuEfa4lBdoarHqUBmpWnVdYEhLYMUW0Wk",
            authDomain: "rednote-99494.firebaseapp.com",
            projectId: "rednote-99494",
            storageBucket: "rednote-99494.firebasestorage.app",
            messagingSenderId: "381708373042",
            appId: "1:381708373042:web:3b2b66b9aefba8b98bc02b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUser = null;
        let isPublic = true;

        onAuthStateChanged(auth, (user) => {
            if (user) currentUser = user;
            else window.location.href = "index.html";
        });

        // Global function for onclick
        window.switchView = function(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        window.togglePrivacy = function() {
            isPublic = !isPublic;
            document.getElementById('privacyIcon').className = isPublic ? 'fas fa-lock-open' : 'fas fa-lock';
            document.getElementById('privacyText').innerText = isPublic ? 'Public' : 'Private';
        }

        function showAlert(msg) {
            const box = document.getElementById('alertBox');
            box.innerText = msg;
            box.style.display = 'block';
            setTimeout(() => { box.style.display = 'none'; }, 2000);
        }


        const thoughtInput = document.getElementById('thoughtInput');
const charCount = document.getElementById('charCount');

thoughtInput.addEventListener('input', () => {
    // تحديث عداد الحروف
    charCount.innerText = thoughtInput.value.length;
    
    // تغيير لون العداد عند الاقتراب من النهاية
    if(thoughtInput.value.length >= 45) {
        charCount.style.color = "red";
    } else {
        charCount.style.color = "#ccc";
    }
});
        
        const nextBtn0 = document.getElementById('nextBtn0');
        thoughtInput.addEventListener('input', () => {
            nextBtn0.classList.toggle('active', thoughtInput.value.length > 0);
        });

        const articleContent = document.getElementById('articleContent');
        const formatBtn = document.getElementById('formatBtn');
        articleContent.addEventListener('input', () => {
            formatBtn.classList.toggle('active', articleContent.value.length > 0);
        });

        window.goToPost = function(type) {
            const title = document.getElementById('articleTitle').value;
            const content = (type === 'thought') ? thoughtInput.value : articleContent.value;
            
            if (type === 'article' && content.length < 100) {
                showAlert("Article must be at least 100 characters");
                return;
            }
            if (content.length === 0) return;

            document.getElementById('previewTitle').innerText = (type === 'article' && title) ? title : (type === 'article' ? "Untitled" : "My Thought");
            document.getElementById('previewText').innerText = content;

            document.getElementById('finalBackBtn').onclick = () => {
                switchView(type === 'thought' ? 'view0' : 'view00');
            };
            switchView('view0000');
        }

        // البحث عن هذا الجزء وتعديله في text.html
document.getElementById('postFinalBtn').onclick = async () => {
    if (!currentUser) return;
    
    const btn = document.getElementById('postFinalBtn');
    btn.disabled = true;
    btn.innerText = "Posting...";

    const postData = {
        userId: currentUser.uid,
        // تم حذف userName من هنا ليعتمد النظام على الـ ID فقط
        title: document.getElementById('previewTitle').innerText,
        content: document.getElementById('previewText').innerText,
        isPublic: isPublic,
        likes: 0,
        views: 0,
        createdAt: serverTimestamp()
    };

    try {
        await addDoc(collection(db, "posts"), postData);
        showAlert("Posted successfully!");
        setTimeout(() => window.location.href = "me.html", 1000);
    } catch (e) {
        console.error(e);
        showAlert("Error posting");
        btn.disabled = false;
        btn.innerText = "Post note";
    }
};


    </script>
</body>
</html>